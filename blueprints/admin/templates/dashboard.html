{% extends "admin_base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_headers %}
    <link rel="stylesheet" href="{{ url_for('admin_bp.static', filename='styles/dashboard.css') }}">
{% endblock %}

{% block content %}
    <h1>Dashboard</h1>

    <div id="blocks-container">
        {% for title, version in version_info.items() %}
            <div class="block block-version block-version-{{ title }}">
                <span class="block-version-title">{{ title }}</span>
                <span class="block-version-version">{{ version }}</span>
            </div>
        {% endfor %}
        <div class="block block-version block-version-os">
            <span class="block-version-title">OS</span>
            <span class="block-version-version">{{ os_info }}</span>
        </div>
        <div id="site-actions-container">
            <button class="button site-action" onclick="reload(this)">
                <i class="fa-solid fa-rotate"></i> Reload
            </button>
        
            <button class="button site-action" onclick="redeploy(this)">
                <i class="fa-solid fa-download"></i> Redeploy
            </button>
        
            <button class="button site-action" onclick="disable(this)">
                <i class="fa-solid fa-ban"></i> Disable
            </button>
        </div>
    </div>

    <script>
        function handleAction(button, endpoint) {
            button.classList.add("loading");
    
            fetch(endpoint, { method: "POST" })
                .then(response => {
                    button.classList.remove("loading");
    
                    if (response.ok) {
                        button.classList.add("done");
                        setTimeout(() => {
                            button.classList.remove("done");
                        }, 750);
                    } else {
                        button.classList.add("error");
                        setTimeout(() => {
                            button.classList.remove("error");
                        }, 2000);
                    }
                })
                .catch(() => {
                    button.classList.remove("loading");
                    button.classList.add("error");
                    setTimeout(() => {
                        button.classList.remove("error");
                    }, 2000);
                });
        }
    
        function reload(button) {
            handleAction(button, "/admin/api/dashboard/reload");
        }
    
        function redeploy(button) {
            handleAction(button, "/admin/api/dashboard/redeploy");
        }
    
        function disable(button) {
            handleAction(button, "/admin/api/dashboard/disable");
        }
    </script>    
{% endblock %}
